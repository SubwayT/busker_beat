<!-- templates/map.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Busker Beat - マップ</title>
    <!-- Leaflet　CSS -->
    <link 
        rel="stylesheet" 
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
        crossorigin="" 
    />
    <!-- カスタム　CSS -->
    <style>
        #map { height: 600px; width: 100%; }
    </style>

    <!-- Leaflet　JS -->
    <script 
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
        crossorigin=""
    ></script>
</head>

<body>
    <h1>Busker Beat マップ</h1>
    <div id="map"></div>

    <!--投稿データをJSに渡す-->
    <script>
        const posts = JSON.parse('{{ posts | tojson | safe }}');
    </script>

    <!-- 地図の初期化 -->
    <script>
      const map = L.map('map').setView([35.6812, 139.7671], 13);  // 東京駅  
        // 地図のタイルレイヤーを追加
        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
            {
                attribution: '&copy; OpenStreetMap contributors'
            }
        ).addTo(map);
        // 投稿データをマーカーとして地図に追加
        posts.forEach(post => {
            const marker = L.marker([post[2], post[3]]).addTo(map);
            marker.bindPopup(`
                <strong>${post[1]}</strong><br>
                開催日: ${post[5]}<br>
                投げ銭: ${post[4]}円<br>
                セトリ: ${post[6]}
            `);
        });
    </script>
</body>
</html>